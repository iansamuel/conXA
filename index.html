<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="A draggable 4x4 grid word arranger with OCR support. Arrange words by dragging, upload screenshots, and export your grids.">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: blob:;
        font-src 'self';
        connect-src 'self' https://cdn.jsdelivr.net;
        worker-src 'self' blob:;
    ">

    <title>Grid Word Arranger - Drag, Drop, and Organize Words</title>

    <!-- Lazy load Tesseract.js only when needed -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h2>Grid Word Arranger</h2>
        <p class="instructions">
            Drag to rearrange ‚Ä¢ Double-click/tap to edit ‚Ä¢ Arrow keys to navigate
        </p>
    </div>

    <div class="controls-container">
        <div class="controls-row">
            <label for="imageUpload" class="btn">
                üì∏ Upload Screenshot
            </label>
            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
            <div id="spinner" class="spinner"></div>
            <span id="status" class="status-text"></span>
        </div>

        <div class="controls-row">
            <button id="exportBtn" class="btn btn-secondary" title="Export grid to JSON file">
                üíæ Export
            </button>
            <button id="importBtn" class="btn btn-secondary" title="Import grid from JSON file">
                üìÇ Import
            </button>
            <input type="file" id="importFile" accept="application/json" style="display: none;">
            <button id="copyBtn" class="btn btn-secondary" title="Copy all text to clipboard">
                üìã Copy
            </button>
            <button id="shareBtn" class="btn btn-secondary" title="Share grid via URL">
                üîó Share
            </button>
        </div>

        <div class="controls-row">
            <button id="darkModeBtn" class="btn btn-icon" title="Toggle dark mode" aria-label="Toggle dark mode">
                üåì
            </button>
            <button id="printBtn" class="btn btn-icon" title="Print grid" aria-label="Print grid">
                üñ®Ô∏è
            </button>
            <button id="helpBtn" class="btn btn-icon" title="Show help" aria-label="Show help">
                ‚ùì
            </button>
            <button id="resetBtn" class="btn btn-danger" title="Reset grid">
                üóëÔ∏è Reset
            </button>
        </div>
    </div>

    <img id="imagePreview" class="image-preview" alt="Uploaded image preview">

    <div class="grid-container" id="grid" role="grid" aria-label="4x4 word grid"></div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal-overlay" role="dialog" aria-labelledby="helpTitle" aria-modal="true">
        <div class="modal">
            <button id="closeModal" class="modal-close" aria-label="Close help">&times;</button>
            <h3 id="helpTitle">Help & Keyboard Shortcuts</h3>

            <div class="help-section">
                <h4>Getting Started</h4>
                <ul>
                    <li>Upload a screenshot of a 4x4 grid to extract text automatically</li>
                    <li>Double-click or double-tap any cell to edit its content</li>
                    <li>Drag and drop cells to rearrange them</li>
                    <li>Your changes are saved automatically</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Keyboard Shortcuts</h4>
                <ul>
                    <li><kbd>Arrow Keys</kbd> - Navigate between cells</li>
                    <li><kbd>Enter</kbd> - Edit selected cell</li>
                    <li><kbd>Esc</kbd> - Cancel editing</li>
                    <li><kbd>Tab</kbd> - Move to next cell</li>
                    <li><kbd>Ctrl/Cmd + Z</kbd> - Undo</li>
                    <li><kbd>Ctrl/Cmd + Shift + Z</kbd> or <kbd>Ctrl/Cmd + Y</kbd> - Redo</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Features</h4>
                <ul>
                    <li><strong>OCR</strong> - Upload screenshots to automatically extract text</li>
                    <li><strong>Export/Import</strong> - Save and load your grids as JSON files</li>
                    <li><strong>Copy</strong> - Copy all grid text to clipboard</li>
                    <li><strong>Share</strong> - Share your grid via URL</li>
                    <li><strong>Dark Mode</strong> - Toggle between light and dark themes</li>
                    <li><strong>Auto-save</strong> - Your work is automatically saved to your browser</li>
                    <li><strong>Undo/Redo</strong> - Up to 50 actions can be undone</li>
                    <li><strong>Print</strong> - Print your grid</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Tips</h4>
                <ul>
                    <li>For best OCR results, use clear screenshots with good contrast</li>
                    <li>The grid layout should be roughly square (4x4)</li>
                    <li>Grid state is saved in your browser's local storage</li>
                    <li>You can share grids by copying the URL after clicking "Share"</li>
                </ul>
            </div>

            <div class="help-section">
                <h4>Accessibility</h4>
                <ul>
                    <li>Full keyboard navigation support</li>
                    <li>Screen reader compatible with ARIA labels</li>
                    <li>High contrast mode support</li>
                    <li>Reduced motion support</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Load Tesseract.js lazily when needed -->
    <script>
        // Lazy load Tesseract.js when user clicks upload
        let tesseractLoaded = false;

        document.getElementById('imageUpload').addEventListener('focus', loadTesseract, { once: true });
        document.querySelector('label[for="imageUpload"]').addEventListener('mouseenter', loadTesseract, { once: true });

        function loadTesseract() {
            if (!tesseractLoaded) {
                tesseractLoaded = true;
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js';
                script.async = true;
                document.head.appendChild(script);
            }
        }
    </script>

    <!-- Load application scripts -->
    <script src="app.js" defer></script>
    <script src="ocr.js" defer></script>
</body>
</html>
